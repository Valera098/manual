<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Инструкция</title>
</head>
<body>
    <div class="container">
        <h1>Загрузка ВЕБ проекта на FIT</h1>
        <p>Общая схема (в случае если вы выполняли проект локально на своем компьютере, либо на другом сервере) </p>
        <h2>Навигация по инструкции</h2>
        <ol>
            <li><a href=#1>Подготовка локального проекта</a>
                <ol type="a">
                    <li><a href=#1.a>Cоздание виртуального окружения</a></li>
                    <li><a href=#1.b>Cохранение последних изменений в Git</a></li>
                </ol>
            </li>
            <li><a href=#2>Перенос файлов на сервер fit.mospolytech.ru</a>
                <ol type="a">
                    <li><a href=#2.a>Через Filezilla</a></li>
                    <li><a href=#2.b>через SSH + Git (рекомендуется делать так)</a></li>
                </ol>
            </li>
            <li><a href=#3>Создание виртуального окружения на сервере FIT</a></li>
            <li><a href=#4>Создание домена для доступа к сайту</a></li>
            <li><a href=#5>Тестирование и решение проблем</a>
                <ol type="a">
                    <li><a href=#5.a>Чек-лист</a></li>
                    <li><a href=#5.b>Просмотр логов</a></li>
                    <li><a href=#5.c>Консоль putty зависла и не отвечает</a></li>
                    <li><a href=#5.d>Другая версия Python</a></li>
                    <li><a href=#5.e>Забыли или не подходит пароль от SSH, FTP</a></li>
                    <li><a href=#5.f>Я точно все делаю правильно, но почему-то не работает</a></li>
                    <li><a href=#5.g>Убедитесь что вы сгенерировали папку со статикой (static)</a></li>
                    <li><a href=#5.h>Редактор VIM</a></li>
                </ol>
            </li>
            <li><a href=#6>Дополнительная литература</a></li>
        </ol>
        <section>
            <h2 id="1">1. Подготовка локального проекта</h2>
            <h3 id="1.a">a. Создание виртуального окружения</h3>
                <img src="img/1a_1.png" alt="Тут должно быть изображение">
                <p>Открываем папку, в которой у вас хранится проект. Если вы склонировали проект с помощью команды git clone, открывайте папку склонированного проекта.</p>
                <img src="img/1a_2.png" alt="Тут должно быть изображение">
                <p>Открываем терминал. В данной инструкции показан терминал, встроенный в программу VSCode.</p>
                <img src="img/1a_3.png" alt="Тут должно быть изображение">
                <p>При помощи команды <b>python -m venv venv</b>, создаем виртуальное окружение</p>
                <img src="img/1a_4.png" alt="Тут должно быть изображение">
                <p>Активируем виртуальное окружение, при помощи команды <b>./venv/scripts/activate</b></p>
                <img src="img/1a_5.png" alt="Тут должно быть изображение">
                <p>Устанавливаем все необходимые библиотеки. Обычно при разработке программы вы по мере
                    необходимости устанавливаете библиотеки, однако не всегда они нужны в итоговой версии.
                    Рекомендуется при каждом добавлении новой библиотеки к проекту обновлять файл
                    requirements.txt, а при сохранении версии проекта просматривать файл requirements.txt и
                    актуализировать его (удалять библиотеки, которые в итоге были исключены, а также добавлять
                    забытые зависимости).</p>
            <h3 id="1.b">b. Загрузка на GIT</h3>
                <img src="img/1b_1.png" alt="Тут должно быть изображение">
                <p>Используем сочетание клавиш <b>CTRL + SHIFT + G</b> и открываем панель управления GIT</p>
                <img src="img/1b_2.png" alt="Тут должно быть изображение">
                <p>Добавляем все изменения в GIT</p>
                <img src="img/1b_3.png" alt="Тут должно быть изображение">
                <p>Вписываем название коммита</p>
                <img src="img/1b_4.png" alt="Тут должно быть изображение">
                <p>Сохраняем версию (коммит)</p>
                <img src="img/1b_5.png" alt="Тут должно быть изображение">
                <p>Отправляем изменения в глобальный репозиторий (на github или bitbucket)</p>
                <img src="img/1b_6.png" alt="Тут должно быть изображение">
                <p>Проверяем, что файлы успешно добавлены в репозиторий.</p>
                <p>При сохранении коммита у вас могут возникнуть ошибки, необходимо внимательно читать
                    сообщение в консоли. Если возникла ошибка, скорее всего ваши изменения не сохранились или
                    не отправились. Необходимо разобраться в ситуации.</p>
                <p>В данной инструкции показан способ через VSCode. Разумеется, вы можете сохранить все
                    изменения через консоль Git вручную (рекомендуется всем научиться это делать и только потом
                    использовать Git GUI).</p>
                <p>Дополнительная литература:</p>
                <ol>
                    <li><a href="https://code.visualstudio.com/docs/editor/github"> https://code.visualstudio.com/docs/editor/github </a></li>
                    <li><a href="https://habr.com/ru/post/273897/"> https://habr.com/ru/post/273897/ </a></li>
                </ol>
            <!-- Пункт C в изначальной инструкции отсутствует -->
        </section>
        <section>
            <h2 id="2">2. Перенос файлов на сервер fit.mospolytech.ru</h2>
            <h3 id="2.a">a. Через Filezilla</h3>
                <p class="warning-text">* Если вы работаете с системой контроля версий Git, переходите сразу к пункту b, где
                    рассматривается вопрос работы с Git. Причины указаны в конце данного подпункта.</p>
                <img src="img/2a_1.png" alt="Тут должно быть изображение"> 
                <p>Создаем папку “project” для проекта в каталоге std.</p>
                <img src="img/2a_2.png" alt="Тут должно быть изображение"> 
                <img src="img/2a_3.png" alt="Тут должно быть изображение">
                <p>Переходим в данный каталог</p>
                <img src="img/2a_4.png" alt="Тут должно быть изображение">
                <p>Загружаем файлы проекта</p>
                <p>Обратите внимание, что “минусом” данного способа является то, что может произойти
                    ситуация, когда вы случайно скопировали не ту версию файлов, какие-то файлы забыли
                    скопировать, а какие-то случайно удалили. В случае с обновлением из репозитория такие
                    ситуации контролировать намного проще и при удалении каких-либо файлов в случае
                    если они ранее были сохранены в репозитории, их можно восстановить.</p>
                <p>А в случае, если папка содержит репозиторий и вы ее переносите через FTP на сервер,
                    возможны ошибки из-за различных конфликтных ситуаций, с которыми вам справится
                    будет довольно тяжело из-за отсутствия опыта.</p>
                <p>Таким образом, данный способ подходит для загрузки файлов проекта на сервер (без
                    копирования папки .git).</p>
                <p>Далее два варианта:</p>
                <ol>
                    <li><p>Папка проекта на сервере управляется системой контроля версий, привязана к тому
                        же репозиторию, что и ваша локальная папка. Тогда вы через консоль Putty
                        выполняете команду git status и далее сохраняете все изменения в части новых
                        файлов, которые вы выполнили.</p></li>
                    <li><p>Вы просто выложили папку, чтобы прикрепить к ней домен и показать
                        преподавателю. Вы можете создать в этой папке отдельный репозиторий для
                        управления. Но возникает вопрос почему у вас проект не управляется Git при
                        разработке.</p></li>
                </ol>
            <h3 id="2.b">Через SSH + Git (рекомендуется делать так)</h3>
                <img src="img/2b_1.png" alt="Тут должно быть изображение">
                <p>Подключитесь через OpenVPN (см. раздел VPN в личном кабинете). В случае, если вы
                    хотите подключиться из Вычислительного центра университета, VPN подключать не
                    требуется.</p>
                <img src="img/2b_2.png" alt="Тут должно быть изображение">
                <p>Открываем Putty и вписываем адрес хоста, который указан на <a href="https://fit.mospolytech.ru/systems/servers">https://fit.mospolytech.ru/systems/servers</a></p>
                <img src="img/2b_3.png" alt="Тут должно быть изображение">
                <p>Нажимаем “Open” для подключения по SSH</p>
                <img src="img/2b_4.png" alt="Тут должно быть изображение">
                <p>В поле login указываем std</p>
                <img src="img/2b_5.png" alt="Тут должно быть изображение">
                <p>Если у вас не создан пароль, то создаем его на fit.mospolytech.ru</p>
                <p>Для удобства вы можете закрепить программу Putty в панели задач и у вас будет быстрый
                    доступ. Обратите внимание, что вы можете одновременно запускать несколько
                    подключений через Putty.</p>
                <p>Также в разделе Connection--&gt;Data вы можете указать свой логин, чтобы не вводить его
                    каждый раз при запуске программы:</p>
                <img src="img/2b_6.png" alt="Тут должно быть изображение">
                <p>Далее не забудьте сохранить сессию:</p>
                <img src="img/2b_7.png" alt="Тут должно быть изображение">
                <img src="img/2b_8.png" alt="Тут должно быть изображение">
                <p>Ура! Мы вошли</p>
                <img src="img/2b_9.png" alt="Тут должно быть изображение">
                <p>Копируем данную ссылку с git-репозитория, чтобы после ее вставить в командную строку
                    в putty консоли</p>
                <img src="img/2b_10.png" alt="Тут должно быть изображение">
                <p>Прописываем git clone *ваша ссылка*, для загрузки репозитория на сервер</p>
                <img src="img/2b_11.png" alt="Тут должно быть изображение">
                <p>Проект успешно передан на сервер</p>
                <img src="img/2b_12.png" alt="Тут должно быть изображение">
                <p>При помощи команды <b>ls</b> проверим, что наш проект загружен на сервер</p>
                <img src="img/2b_13.png" alt="Тут должно быть изображение">
                <p>Перейдем в эту папку и проверим все файлы.</p>
                <p>Если на сервере уже проект склонирован и вам нужно обновить файлы, то заходите в
                    папку проекта и выполняете команду “git pull”. Сохраненные на локальном компьютере
                    изменения и отправленные в глобальный репозиторий на github (в данном случае), будут
                    обновлены при выполнении данной команды. В случае, если ваш репозиторий на сервере
                    содержит несохраненные изменения (можно узнать с помощью команды git status), Git
                    сообщит вам об этом и нужно будет сначала сохранить изменения, а только потом
                    обновлять (запрашивать) изменения из глобального репозитория.</p>
                <p>Дополнительная литература</p>
                <ol>
                    <li><a href="https://fit.mospolytech.ru/systems/vpn">https://fit.mospolytech.ru/systems/vpn</a></li>
                </ol>
        </section>
        <section>
            <h2 id="3">3. Создание виртуального окружения на сервере FIT</h2>
                <p>При создании ваших сайтов, приложений, программы вы используете конкретные версии
                библиотек, языков. Для обеспечения работоспособности программ при переносе с одного
                сервера, компьютера на другие (например, когда вы разрабатываете проект локально, а
                запускаете на боевом сервере, либо когда разработка идет в команде), используются
                виртуальные окружения, в которые вы можете установить любой набор необходимых вам
                библиотек, причем конкретные версии библиотек (если не указываем версию, устанавливается
                последняя актуальная). При этом на одном сервере или компьютере вы можете иметь несколько
                таких окружений и быстро переключаться при работе с разными проектами.</p>
                <img src="img/3_1.png" alt="Тут должно быть изображение">
                <p>Создаем виртуальное окружение в созданной папке проекта при помощи Putty</p>
                <img src="img/3_2.png" alt="Тут должно быть изображение">
                <p>Активируем виртуальное окружение</p>
                <img src="img/3_3.png" alt="Тут должно быть изображение">
                <p>Устанавливаем все необходимые библиотеки (они указаны в файле requirements.txt,
                    который вы предварительно создали и сохранили в систему контроля версий Git) с помощью
                    команды</p>
                <P><b>pip install -r requirements.txt</b></P>
                <p>Обратите внимание, что название “requirements.txt” общепринятое, но не обязательное. Вы
                    можете использовать и другое (однако при этом в документации к проекту, в разделе для
                    установки вы должны обратить на это особое внимание пользователей).</p>
                <p>Если файл requirements.txt лежит на в корне папки, то нужно дополнительно указать путь
                    до этого файла. Например, если папка называется “req”, то команда будет “<b>pip install
                    -r req/requirements.txt</b>”. Либо вы в консоли сначала переходите в эту папку (cd
                    req) и тогда выполняете “ pip install -r requirements.txt”.</p>
                <p>Если вы не используете систему контроля версий Git и файл requirements.txt, вы можете
                    установить каждый пакет отдельно.</p>
                <p>Для проверки можно распечатать все установленные пакеты с помощью команды <b>pip
                    freeze</b></p>
        </section>
        <section>
            <h2 id="4">4. Создание домена для доступа к сайту</h2>
                <img src="img/4_1.png" alt="Тут должно быть изображение">
                <p>На <a href="https://fit.mospolytech.ru/systems/servers">https://fit.mospolytech.ru/systems/servers</a> нажимаем на кнопку добавить домен</p>
                <img src="img/4_2.png" alt="Тут должно быть изображение">
                <p>Выбираем необходимую версию Python</p>
                <img src="img/4_3.png" alt="Тут должно быть изображение">
                <p><b>Пусть до проекта - в случае Django это папка, в которой лежит файл manage.py</b></p>
                <p>После того, как указали все необходимое нажимаем “Добавить”</p>
        </section>
        <section>
            <h2 id="5">5. Тестирование и решение проблем</h2>
                <p>После загрузки проекта на сервер и создания домена (ссылки на проект) необходимо убедиться, что проект работает корректно, 
                    нет ошибок, связанных с переносом проекта на другой сервер.</p>
            <h3 id="5.a">5.1 Чек-лист</h3>
                <p>Для этого предлагаем воспользоваться следующим чек-листом:</p>
                <ol>
                    <li><p>Главная страница и другие открываются корректно. Пройтись по гиперссылкам, чтобы проверить, что URL проекта работают корректно.</p></li>
                    <li><p>Проверка статический файлов (картинки, ссылки на файлы)</p>
                        <ol type="a">
                            <li>Визуальная проверка</li>
                            <li>В консоли браузера отсутствуют ошибки 404. Например, потому что забыли в Git положить какие-то файлы или же забыли их перенести, если делали через FTP</li>
                            <li>В коде все ссылки на ресурсы являются относительными или прямая ссылка на внешний ресурс. То есть нет ссылок на ваш личный компьютер</li>
                        </ol></li>
                    <li>Проверка медиа файлов (то, что грузит пользователь через ваш проект)</li>
                    <li>Проверка базы данных
                        <ol type="a">
                            <li><p>При разработке проекта на нескольких компьютерах необходимо следить за
                                структурой базы данных, т.к. в некоторых случаях ваш проект не будет работать вообще
                                (а не только раздел, где были внесены изменения в базу). Если говорить о фреймворке
                                Django, то в нем это реализуется через механизм миграций. При внесении изменений в
                                структуру базы данных вы создаете файл миграции и далее выполняете их по очереди на
                                новом сервере. <a href="https://django.fun/docs/django/ru/3.0/topics/migrations/">https://django.fun/docs/django/ru/3.0/topics/migrations/</a>
                            </p></li>
                            <li><p>Если вам необходимо перенести базу данных, вы должны создать дамп
                                локальной базы и далее перенести данные в базу на сервере.</p></li>
                        </ol>
                    </li>
                </ol>   
            <h3 id="5.b">5.2 Просмотр логов</h3>
                <p>Если у вас возникла ошибка 502 или иная другая, необходимо обратиться к файлу логов
                    для просмотра сведений о возникшей ошибке. Необходимо найти файл “/var/log/unit.log”,
                    он находится в корне сервера (а не в папке ), поэтому в начале пути вы видите “/”</p>
                <p>Команда pwd поможет вам узнать путь до текущей папки в консоли</p>
                <img src="img/5b_1.png" alt="Тут должно быть изображение">
                <p>Переместиться в корень можно с помощью команды “cd /”</p>
                <p>Логи можно посмотреть с помощью команды:</p>
                <p><b>sudo tail -f /var/log/unit.log</b></p>
                <p>Выход из tail - комбинация Ctrl+C</p>
                <p>Итак, в самом файле логов вам необходимо найти последние сообщения, понять в чем их
                    суть и исправить ошибку.</p>
                <p>Частая ошибка - не установлена та или иная библиотека, установлена иная версия
                    библиотеки (именно для этого в файлике requirements.txt мы также указываем конкретную
                    версию библиотеки). Если вы не указываете конкретную версию, система установит
                    последнюю актуальную, а вы, возможно, разрабатываете проект на более старой.</p>
                <p>Подсказка. Скопируете текст ошибки и попробуйте найти информацию через поисковик.
                    Разработчики часто консультируются друг у друга в интернете, поэтому множество
                    проблем решаются очень быстро, т.к. они типовые.</p>
            <h3 id="5.c">5.3 Консоль putty зависла и не отвечает</h3>
                <p>Это нормально, соединение обрывается по тайм-ауту. Необходимо заново подключиться.
                    Для удобства вы можете закрепить программу Putty в панели задач и у вас будет быстрый
                    доступ. Обратите внимание, что вы можете одновременно запускать несколько
                    подключений через Putty.</p>
                <p>Также в разделе Connection--&gt;Data вы можете указать свой логин, чтобы не вводить его
                    каждый раз при запуске программы:</p>
                <img src="img/5с_1.png" alt="Тут должно быть изображение">
                <p>Далее не забудьте сохранить сессию:</p>
                <img src="img/5с_2.png" alt="Тут должно быть изображение">
            <h3 id="5.d">5.4 Другая версия Python</h3>
                <p>В системе FIT установлено несколько версий языка Python, вы можете выбрать любую
                    установленную. Для этого при создании виртуального окружения необходимо указать
                    конкретную версию, а именно в случае если нужна версия 3.1 вместо python указать
                    python3.7</p>
            <h3 id="5.e">5.5 Забыли или не подходит пароль от SSH, FTP</h3>
                <p>Все просто - заходите в личный кабинет и меняете. Пароль обновится сразу. Обратите
                    внимание, что мы НЕ рекомендуем использовать простые пароли. Например, 12345678 и
                    подобные. Это не безопасно. Другие студенты и злоумышленники могут получить доступ
                    к вашей виртуалки и выложить там некорректный контент, а вам потом сложно будет
                    доказать, что это сделали не вы лично. Однако для тестирования системы (когда вы не
                    понимаете что идет не так), создание простого пароля помогает убедится, что с
                    авторизацией и аутентификацией на сервере все в порядке. А у вас на клавиатуре
                    залипают клавиши, включен Caps Lock или выбран другой язык ввода.</p>
                <img src="img/5e_1.png" alt="Тут должно быть изображение">
            <h3 id="5.f">5.6 Я точно все делаю правильно, но почему-то не работает</h3>
                <ol>
                    <li>Предлагаем нажать на кнопку “обновить сервер”. Возможно какие-то стандартные
                        настройки виртуалки сбросились или не обновились</li>
                    <li>Поискать ответ в документации еще раз <a href="https://fit.mospolytech.ru/systems/documentation">https://fit.mospolytech.ru/systems/documentation</a></li>
                    <li>Задать вопрос по почте ist@fit.mospolytech.ru (с этой почты приходят все письма с сервера)</li>
                    <li>Обратиться к Даньшиной Марине Владимировне по почте, телеграму, ВКонтакте</li>
                </ol>
                <img src="img/5f_1.png" alt="Тут должно быть изображение">
            <h3 id="5.g">5.7 Убедитесь что вы сгенерировали папку со статикой (static)</h3>
                <p>Самая распространенная проблема, с которой сталкиваются многие.</p>
                <p>В терминале выполняем команду <b>python manage.py collectstatic.</b></p>
                <p>После чего у нас появляется папка <b>static.</b></p>
                <p>Дописываем необходимые строки в файлы:</p>
                <img src="img/5g_1.png" alt="Тут должно быть изображение">
                <p>SETTINGS.PY</p>
                <img src="img/5g_2.png" alt="Тут должно быть изображение">
                <p>URLS.PY</p>
            <h3 id="5.h">5.8 Редактор VIM</h3>
                <p>Выход из редактора Vim - необходимо в режиме ввода команд набрать “:q” , либо “:q!”,
                    если вы вносили какие-то изменения (сохранять изменения не нужно).</p>
                <p>Переход в режим редактирования Vim - нажать на букву i</p>
                <p>Выйти из режима редактирования - Esc</p>
                <p>Более подробную информацию о редакторе Vim можно найти в сети Интернет, например,
                    на этом сайте <a href="https://ru.wikibooks.org/wiki/Vim">https://ru.wikibooks.org/wiki/Vim</a></p>
        </section>
        <h2 id="6">Дополнительная литература</h2>
        <ol>
            <li><a href="https://medium.com/@wihlarko26/how-to-create-requirements-txt-on-django-project-b774cd3f3471">https://medium.com/@wihlarko26/how-to-create-requirements-txt-on-django-project-b774cd3f3471</a></li>
            <li><a href="https://docs.python.org/3/tutorial/venv.html">https://docs.python.org/3/tutorial/venv.html</a></li>
            <li><a href="https://andrewroblesdev.medium.com/creating-a-django-project-inside-a-virtual-environment-8e9b874e1a03">https://andrewroblesdev.medium.com/creating-a-django-project-inside-a-virtual-environment-8e9b874e1a03</a></li>
        </ol>
    </div>
</body>
</html>